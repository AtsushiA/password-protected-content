(()=>{async function t(t){const e=(new TextEncoder).encode(t),o=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(o)).map(t=>t.toString(16).padStart(2,"0")).join("")}function e(t){try{if(!t||"string"!=typeof t)throw new Error("Invalid base64 input");const e=t.trim().replace(/\s/g,""),o=atob(e),r=new Uint8Array(o.length);for(let t=0;t<o.length;t++)r[t]=o.charCodeAt(t);return new TextDecoder("utf-8").decode(r)}catch(t){throw console.error("Decode error:",t),new Error("コンテンツのデコードに失敗しました")}}function o(){const o=document.querySelectorAll(".wp-block-telex-password-protected-content");for(const r of o){const o=r.querySelector(".password-protected-content__form"),n=r.querySelector(".password-protected-content__input"),c=r.querySelector(".password-protected-content__button"),s=r.querySelector(".password-protected-content__error"),d=r.dataset.content,a=r.dataset.passwordHash;o&&d&&a?o.addEventListener("submit",async function(o){o.preventDefault();const i=n.value.trim();if(!i)return;c.disabled=!0;const l=c.textContent;c.textContent="確認中...",s&&(s.style.display="none");try{if(await t(i)!==a)throw new Error("Invalid password");const o=e(d);if(!o)throw new Error("Empty content");r.innerHTML='<div class="password-protected-content__unlocked"><div class="password-protected-content__content">'+o+"</div></div>",r.classList.add("is-unlocked")}catch(t){console.error("Password verification error:",t),s&&(s.textContent="パスワードが正しくありません。",s.style.display="block"),c.disabled=!1,c.textContent=l,n.value="",n.focus()}}):console.warn("Password protected block missing required data:",r)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o()})();