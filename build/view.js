(()=>{async function t(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map(t=>t.toString(16).padStart(2,"0")).join("")}function e(t){try{if(!t||"string"!=typeof t)throw new Error("Invalid base64 input");const e=t.trim().replace(/\s/g,""),n=atob(e),o=new Uint8Array(n.length);for(let t=0;t<n.length;t++)o[t]=n.charCodeAt(t);return new TextDecoder("utf-8").decode(o)}catch(t){throw console.error("Decode error:",t),new Error("コンテンツのデコードに失敗しました")}}function n(){const n=document.querySelectorAll(".wp-block-telex-password-protected-content");for(const o of n){const n=o.querySelector(".password-protected-content__form"),r=o.querySelector(".password-protected-content__input"),s=o.querySelector(".password-protected-content__button"),a=o.querySelector(".password-protected-content__error"),c=o.dataset.content,d=o.dataset.passwordHash,i=o.dataset.linkData;n&&c&&d?n.addEventListener("submit",async function(n){n.preventDefault();const l=r.value.trim();if(!l)return;s.disabled=!0;const p=s.textContent;s.textContent="確認中...",a&&(a.style.display="none");try{if(await t(l)!==d)throw new Error("Invalid password");const n=e(c);if(!n)throw new Error("Empty content");let r="",s="",a="_self";if(i&&""!==i.trim())try{const t=e(i),n=JSON.parse(t);r=n.url||"",s=n.text||"詳細を見る",a=n.target||"_self"}catch(t){console.warn("Failed to decode link data:",t)}let p='<div class="password-protected-content__unlocked">';if(p+='<div class="password-protected-content__content">'+n+"</div>",r&&""!==r.trim()){const t=r.replace(/"/g,"&quot;"),e=a||"_self";p+='<div class="password-protected-content__link">',p+='<a href="'+t+'" class="password-protected-content__link-button" target="'+e+'"'+("_blank"===e?' rel="noopener noreferrer"':"")+">",p+='<span class="dashicon dashicons dashicons-admin-links"></span>',p+=s||"詳細を見る",p+="_blank"===e?'<span class="dashicon dashicons dashicons-external"></span>':"",p+="</a>",p+="</div>"}p+="</div>",o.innerHTML=p,o.classList.add("is-unlocked")}catch(t){console.error("Password verification error:",t),a&&(a.textContent="パスワードが正しくありません。",a.style.display="block"),s.disabled=!1,s.textContent=p,r.value="",r.focus()}}):console.warn("Password protected block missing required data:",o)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()})();